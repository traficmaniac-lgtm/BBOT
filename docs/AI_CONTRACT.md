# AI Contract

## Запрос
- Формат: промт с активной парой, рыночным срезом, фильтрами биржи и текущими настройками.
- Пользователь добавляет текстовый запрос; AI отвечает в единственном сообщении.

## Формат ответа
Ответ состоит из двух секций:
```
### EXPLANATION
<краткий текст>
### SETTINGS_JSON
{
  "budget_usdt": 150,
  "max_orders": 4,
  "grid_step_pct": 0.4,
  "take_profit_pct": 1.8,
  "stop_loss_pct": 1.2,
  "cooldown_seconds": 12,
  "update_interval_ms": 1200
}
```

## Валидация
- SETTINGS_JSON валидируется через `TradeSettingsSchema` в `ai/client.py` (все поля обязательны, числа >= 0).
- EXPLANATION сохраняется как текст без доп. требований.
- При ошибке парсинга/валидации state=ERROR и показывается сообщение пользователю; повтор до исчерпания `max_retries`.

## Ошибки
- Отсутствие секции `### SETTINGS_JSON` или невалидный JSON → показ ошибки в UI, Apply недоступен.
- Секреты (ключи) никогда не логируются в AI запросах/ответах.
