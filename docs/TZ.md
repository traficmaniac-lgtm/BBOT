# Техническое задание: Desktop Trading Copilot

## Обзор
Desktop-приложение с GUI, которое помогает трейдеру управлять спотовыми и фьючерсными позициями через подключаемые биржи. Первая версия концентрируется на настройках, загрузке fee-free пар, AI-анализе параметров и подготовке к запуску торгового движка. Реальный трейдинг в этой итерации не реализуется, но архитектура готова к расширению.

## Цели версии v0.1
- Предоставить кликабельный GUI с основными экранами и логикой переходов состояний.
- Поддержать загрузку списка пар без комиссий (мок-режим), фильтрацию и выбор активной пары.
- Настройки и конфиги: сохранение/загрузка YAML, отображение активного конфига, базовая валидация.
- AI-анализ торговых параметров через OpenAI или мок-клиент по формату `docs/AI_CONTRACT.md`.
- Подготовить каркас state-machine и логирования.
- Обеспечить «связь» Codex ↔ Victoria через `/assistant` файлы.

## Архитектурные принципы
- Модульность: отдельные пакеты `core/`, `ai/`, `ui/`, `exchanges/`, `strategies/`, `risk/`.
- Расширяемость: интерфейсы для бирж и стратегий, конфигируемость через YAML, чистые контракты AI.
- Прозрачность: логирование действий, статусная машина, понятные ошибки.
- Desktop-first: нулевая зависимость от внешних сервисов для запуска (AI и биржи можно мокать).

## Пользовательские сценарии
1. Пользователь запускает приложение через `run_app.bat` → появляется GUI.
2. Вкладка Settings: вводит API ключи биржи, OpenAI key, выбирает биржу/testnet, сохраняет конфиг.
3. Вкладка Pairs: жмёт «Load fee-free pairs», видит таблицу пар, фильтрует, выбирает активную.
4. Вкладка AI: просматривает промт, запускает AI-анализ, получает JSON, применяет параметры.
5. Вкладка Trading: задаёт бюджет, видит параметры от AI, запускает/останавливает моковый движок.
6. Вкладка Logs: наблюдает лог, экспортирует при необходимости.

## Нефункциональные требования
- Python 3.10+.
- GUI на стандартной библиотеке (tkinter) без сложных зависимостей.
- Конфиги хранятся в `config/config.yaml` (локально) и примере `config/config.example.yaml`.
- Логи в `logs/app.log`.
- Поддержка Windows запуска через `.bat` файлы.

## Состояния приложения
```
IDLE → CONFIGURED → PAIRS_LOADED → AI_READY → RUNNING → STOPPED → ERROR
```
- `CONFIGURED`: конфиг загружен и валиден.
- `PAIRS_LOADED`: получены пары (из API или мок).
- `AI_READY`: получен валидный JSON AI.
- `RUNNING`: торговый процесс запущен (мок).
- `STOPPED`: остановлен пользователем.
- `ERROR`: критическая ошибка или невалидный ответ.

## Модули
- `core.config_service`: загрузка/сохранение конфигов, валидация pydantic.
- `core.state`: enum состояний, простая state-machine.
- `core.logger`: настройка логирования в файл и консоль.
- `ai.prompt_builder`: сборка промта для OpenAI/мока.
- `ai.client`: вызов OpenAI или мока, валидация по `AI_CONTRACT`.
- `ui.app`: корневой GUI, вкладки, действия, стейт.
- `ui.widgets`: вспомогательные элементы (таблица пар, лог-оконце, формы).
- `exchanges.base`: интерфейс бирж, мок-загрузчик пар.
- `strategies.base`: заглушка стратегий.
- `risk.rules`: базовые настройки риска (моки).

## Точки расширения
- Реализация реального биржевого клиента в `exchanges/`.
- Настоящие стратегии в `strategies/` и управление позициями.
- Расширение AI-контракта (подбор тейк-профитов/стопов, риск-параметры).
- Добавление аналитики/репортинга в `data/`.

